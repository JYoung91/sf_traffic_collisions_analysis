---
title: "traffic_collisions_sf"
author: "Jeremie Young"
date: "November 6, 2018"
output: html_document
---

# load accident dataset as CSV file
```{r}
library(readr)
CollisionRecords <- read_csv("C:/Users/Jeremie/Google Drive/Springboard Intro to Data Science/Capstone/Raw Datasets/CollisionRecords2010_2018.txt")
head(CollisionRecords)

```

# import both dplyr and tidyr packages to use
```{r}
library(dplyr)
library(tidyr)
```


# subset dataframe by removing unused variables
```{r}
CollisionRecords <- CollisionRecords %>% 
             select(-JURIS, -OFFICER_ID, -REPORTING_DISTRICT, -CHP_SHIFT, -CITY_DIVISION_LAPD, -CITY_DIVISION_LAPD, -CALTRANS_COUNTY, -CALTRANS_DISTRICT, -ROUTE_SUFFIX, -POSTMILE_PREFIX, -POSTMILE, -CHP_ROAD_TYPE, -LATITUDE, -LONGITUDE)
head(CollisionRecords)

```

# begin geocoding coordinate extraction process - concatenate/unite cross streets
```{r}
CollisionRecords <- CollisionRecords %>% 
              unite(CROSS_ST, PRIMARY_RD, SECONDARY_RD, sep = " & ")
```

# create new column for city and state to insert into dataframe
```{r}
library(tibble)
CITY <- "SAN FRANCISCO"
STATE <- "CA"
CollisionRecords <- CollisionRecords %>% 
    add_column(CITY, STATE, .after = "CROSS_ST")
```

# subset CASE_ID, CROSS_ST, CITY, STATE as csv export to extract coordinates on https://www.geocod.io/
```{r}
coordinates <- CollisionRecords %>%  
    select(CASE_ID, CROSS_ST:STATE)
write.table(coordinates, "coordinates.csv", row.names = FALSE, sep = ",")

```

# import geocoded sheet with coordinate data
```{r}
coordinates_geocodio <- read_csv("C:/Users/Jeremie/Google Drive/Springboard Intro to Data Science/Capstone/coordinates_geocodio.csv")
head(coordinates_geocodio)
```

# clean out undeliverable records that resulted in missing data (0 for coordinates & accurancy), coordinate accuracy level of less than .7, and incorrect geocoding to San Mateo County
```{r}
coordinates_geocodio <- coordinates_geocodio %>% 
    filter(`Accuracy Score` != 0 & `Accuracy Score` > .7 & County != "San Mateo County")
```

# keep pertinent columns
```{r}
coordinates_geocodio <- coordinates_geocodio %>% 
    select(CASE_ID, Latitude, Longitude, `Accuracy Score`, `Accuracy Type`, Zip)
```

# reinsert into original dataset and remove records
```{r}
CollisionRecords <- full_join(CollisionRecords, coordinates_geocodio, by = "CASE_ID")
```

# remove N/A records
```{r}
CollisionRecords <- CollisionRecords %>% 
    filter(!is.na(`Accuracy Score`))
```

# summarize data
```{r}
CollisionRecords %>% 
  group_by(Zip) %>%  
    summarise(medianNUMBER_INJURED = median(NUMBER_INJURED),
              meanNUMBER_INJURED = mean(NUMBER_INJURED),
              maxNUMBER_INJURED = max(NUMBER_INJURED),
              sdNUMBER_INJURED = sd(NUMBER_INJURED),
              frequencyNUMBER_INJURED = sum(NUMBER_INJURED),
                                                  
              medianNUMBER_KILLED = median(NUMBER_KILLED),
              meanNUMBER_KILLED = mean(NUMBER_KILLED),
              maxNUMBER_KILLED = max(NUMBER_KILLED),
              sdNUMBER_KILLED = sd(NUMBER_KILLED),
              frequencyNUMBER_KILLED = sum(NUMBER_KILLED)) %>%  
      top_n(5)
```

# analyze dependant variable COLLISION_SEVERITY against predictive variables
```{r}
library(ggplot2)
ggplot(CollisionRecords, aes(factor(COLLISION_SEVERITY), fill = factor(COLLISION_SEVERITY))) +
    geom_bar()

ggplot(CollisionRecords, aes(factor(COLLISION_SEVERITY), fill = factor(COLLISION_SEVERITY))) +
    geom_bar() +
    facet_grid(~ Zip)

ggplot(CollisionRecords, aes(factor(PCF_VIOL_CATEGORY), factor(COLLISION_SEVERITY))) +
    geom_jitter()

ggplot(CollisionRecords, aes(factor(LIGHTING), factor(COLLISION_SEVERITY))) +
    geom_jitter()

ggplot(CollisionRecords, aes(factor(LIGHTING), factor(COLLISION_SEVERITY))) +
    geom_jitter()

ggplot(CollisionRecords, aes(factor(ROAD_SURFACE), factor(COLLISION_SEVERITY))) +
    geom_jitter()

ggplot(CollisionRecords, aes(factor(PED_ACTION), factor(COLLISION_SEVERITY))) +
    geom_jitter()

ggplot(CollisionRecords, aes(factor(ALCOHOL_INVOLVED), factor(COLLISION_SEVERITY))) +
    geom_jitter()

```